<core:FragmentDefinition
    xmlns:core="sap.ui.core"
    xmlns:unified="sap.ui.unified"
    xmlns:form="sap.ui.layout.form"
    xmlns="sap.uxap"
    xmlns:layout="sap.ui.layout"
    xmlns:m="sap.m"
    xmlns:f="sap.ui.layout.form"
>
    <ObjectPageSection
        titleUppercase="false"
        title="{i18n>generalinformation}"
    >
        <subSections>
            <ObjectPageSubSection title="{i18n>coreInformation}">
                <f:SimpleForm
                    editable="true"
                    layout="ResponsiveGridLayout"
                    labelSpanL="3"
                    labelSpanM="3"
                    emptySpanL="0"
                    emptySpanM="0"
                    columnsL="1"
                    columnsM="1"
                    adjustLabelSpan="false"
                    singleContainerFullSize="false"
                >
                    <f:content>
                        <m:Label
                            labelFor="empnameEdit"
                            text="{i18n>emp.employeename}"
                        />
                        <m:Input
                            value="{path: 'employee/name'}"
                            editable="false"
                        />
                        <m:Label
                            labelFor="startDateEdit"
                            text="{i18n>emp.startDate}"
                        />
                        <m:DatePicker
                            value="{path: 'startDate', type: 'sap.ui.model.odata.type.Date'}"
                            valueFormat="yyyy-MM-dd"
                            displayFormat="medium"
                        />
                        <m:Label
                            labelFor="endDateEdit"
                            text="{i18n>emp.endDate}"
                        />
                        <m:DatePicker
                            value="{path: 'endDate', type: 'sap.ui.model.odata.type.Date'}"
                            valueFormat="yyyy-MM-dd"
                            displayFormat="medium"
                        />
                        <m:Label
                            labelFor="destinationEdit"
                            text="{i18n>emp.destination}"
                        />
                        <m:Input
                            id="destinationEdit"
                            value="{path: 'destination'}"
                            editable="false"
                        />
                        <m:Label
                            labelFor="meansOfTransportEdit"
                            text="{i18n>emp.meansOfTransport}"
                        />
                        <m:ComboBox
                            value="{meansOfTransport}"
                            change=".onMeansOfTransportChange"
                        >
                            <core:Item
                                key="Auto"
                                text="Auto"
                            />
                            <core:Item
                                key="Zug"
                                text="Zug"
                            />
                            <core:Item
                                key="Flug"
                                text="Flug"
                            />
                        </m:ComboBox>
                        <m:Label
                            labelFor="hotelEdit"
                            text="{i18n>emp.hotel}"
                        />
                        <m:Switch state="{path: 'hotel'}" />
                    </f:content>
                </f:SimpleForm>
            </ObjectPageSubSection>

            <ObjectPageSubSection
                title="{i18n>outboundFlight}"
                visible="{= %{meansOfTransport} === 'Flug' }"
            >
                <f:SimpleForm
                    editable="true"
                    layout="ResponsiveGridLayout"
                    labelSpanL="3"
                    labelSpanM="3"
                    emptySpanL="0"
                    emptySpanM="0"
                    columnsL="1"
                    columnsM="1"
                >
                    <f:content>
                        <!-- Route-Auswahl statt Einzel-Inputs -->
                        <m:Label text="Route auswählen" />
                        <m:Select
                            id="outboundRouteSelect"
                            width="100%"
                            forceSelection="true"
                            selectedKey="{flights/outboundFlightRoute_ID}"
                            change=".onOutboundRouteChange"
                            items="{ 
                                path: '/FlightRoute',
                                templateShareable: false,
                                parameters: {
                                    $$ownRequest: true,
                                    $expand: 'departureLocation,arrivalLocation',
                                    $select: 'ID,flightNumber,departureTime,arrivalTime,departureLocation/iata,arrivalLocation/iata,arrivalLocation/city'
                                }
                            }"
                        >
                            <core:Item
                                key="{ID}"
                                text="{= ${flightNumber} + '  ' + ${departureLocation/iata} + ' → ' + ${arrivalLocation/iata} + '  (' + ${departureTime} + '–' + ${arrivalTime} + ')' }"
                            />
                        </m:Select>
                    </f:content>
                </f:SimpleForm>
            </ObjectPageSubSection>
            <ObjectPageSubSection
                title="{i18n>returnFlight}"
                visible="{= %{meansOfTransport} === 'Flug' }"
            >
                <f:SimpleForm
                    editable="true"
                    layout="ResponsiveGridLayout"
                    labelSpanL="3"
                    labelSpanM="3"
                    emptySpanL="0"
                    emptySpanM="0"
                    columnsL="1"
                    columnsM="1"
                >
                    <f:content>
                        <!-- Route-Auswahl statt Einzel-Inputs -->
                        <m:Label text="Route auswählen" />
                        <m:Select
                            width="100%"
                            forceSelection="true"
                            selectedKey="{flights/returnFlightRoute_ID}"
                            id="returnRouteSelect"
                            items="{ 
                                path: '/FlightRoute',
                                templateShareable: false,
                                parameters: {
                                    $$ownRequest: true,
                                    $expand: 'departureLocation,arrivalLocation',
                                    $select: 'ID,flightNumber,departureTime,arrivalTime,departureLocation/iata,arrivalLocation/iata'
                                }
                            }"
                        >
                            <core:Item
                                key="{ID}"
                                text="{= ${flightNumber} + '  ' + ${departureLocation/iata} + ' → ' + ${arrivalLocation/iata} + '  (' + ${departureTime} + '–' + ${arrivalTime} + ')' }"
                            />
                        </m:Select>
                    </f:content>
                </f:SimpleForm>
            </ObjectPageSubSection>

            <ObjectPageSubSection title="{i18n>bookinginformation}">
                <f:SimpleForm
                    editable="true"
                    layout="ResponsiveGridLayout"
                    labelSpanL="3"
                    labelSpanM="3"
                    emptySpanL="0"
                    emptySpanM="0"
                    columnsL="1"
                    columnsM="1"
                    adjustLabelSpan="false"
                    singleContainerFullSize="false"
                >
                    <m:Label text="{i18n>bookingnumber}" />
                    <m:Input value="{path: 'booking/bookingNumber'}" />
                    <m:Label text="{i18n>bookingStatus}" />
                    <m:Select
                        selectedKey="{path: 'booking/status/name', formatter:'.formatStatusState'}"
                    >
                        <core:Item
                            key="Neu"
                            text="Neu"
                        />
                        <core:Item
                            key="Bereit zur Bearbeitung"
                            text="Bereit zur Bearbeitung"
                        />
                        <core:Item
                            key="In Bearbeitung"
                            text="In Bearbeitung"
                        />
                        <core:Item
                            key="Gebucht"
                            text="Gebucht"
                        />
                        <core:Item
                            key="Abgeschlossen"
                            text="Abgeschlossen"
                        />
                        <core:Item
                            key="Storniert"
                            text="Storniert"
                        />
                    </m:Select>
                </f:SimpleForm>
            </ObjectPageSubSection>

            <ObjectPageSubSection title="{i18n>attachments}">
                <m:List
                    items="{path: 'attachments'}"
                    mode="Delete"
                    delete=".onDeleteAttachment"
                >
                    <m:CustomListItem>
                        <m:HBox
                            justifyContent="SpaceBetween"
                            alignItems="Center"
                            class="sapUiSmallMargin"
                        >
                            <m:VBox>
                                <m:Text
                                    text="{fileName}"
                                    class="sapMH4FontSize"
                                />
                                <m:Text
                                    text="{description}"
                                    class="sapUiTinyMarginTop"
                                />
                                <m:Text
                                    text="{path: 'size', formatter: '.formatFileSize'}"
                                    class="sapUiTinyMarginTop"
                                />
                            </m:VBox>
                            <m:Link
                                text="{i18n>show}"
                                target="_blank"
                                href="{path: 'content', type:'sap.ui.model.odata.type.Stream'}"
                            />
                        </m:HBox>
                    </m:CustomListItem>
                </m:List>
            </ObjectPageSubSection>

            <ObjectPageSubSection title="{i18n>additionalcomments}">
                <m:List
                    items="{path:'comments'}"
                    showSeparators="None"
                    growing="false"
                    mode="Delete"
                    delete=".onDeleteComment"
                >
                    <m:CustomListItem class="commentItem">
                        <m:HBox
                            alignItems="Start"
                            class="sapUiSmallMargin"
                            justifyContent="Start"
                        >
                            <m:Avatar
                                displayShape="Circle"
                                backgroundColor="Accent6"
                                initials="{= ${createdBy} ? ${createdBy}.substring(0,2).toUpperCase() : 'U'}"
                                class="sapUiTinyMarginEnd"
                            />
                            <m:VBox
                                width="100%"
                                class="sapUiSmallMarginBegin"
                            >
                                <m:HBox
                                    columnGap="1rem"
                                    class="sapUiTinyMarginBottom"
                                >
                                    <core:Icon
                                        src="sap-icon://person-placeholder"
                                    />
                                    <m:Text text="{createdBy}" />
                                </m:HBox>
                                <m:HBox
                                    columnGap="1rem"
                                    class="sapUiTinyMarginBottom"
                                >
                                    <core:Icon src="sap-icon://calendar" />
                                    <m:Text
                                        text="{ path:'createdAt', formatter:'.formatDateTime'}"
                                        wrapping="false"
                                        class="sapUiTinyMarginBottom sapUiSmallFontSize"
                                    />
                                </m:HBox>
                                <m:HBox
                                    columnGap="1rem"
                                    class="sapUiTinyMarginBottom"
                                >
                                    <core:Icon src="sap-icon://comment" />
                                    <m:TextArea value="{ path:'message'}" />
                                </m:HBox>
                            </m:VBox>
                        </m:HBox>
                    </m:CustomListItem>
                </m:List>
            </ObjectPageSubSection>
        </subSections>
    </ObjectPageSection>
</core:FragmentDefinition>
